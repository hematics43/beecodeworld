<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Number-Aware Text Frequency Analyzer</title>
<style>
  body {
    font-family: "Poppins", "Segoe UI", Roboto, sans-serif;
    background: #f5f7fb;
    color: #333;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    margin: 0;
  }

  .container {
    background: #fff;
    width: 90%;
    max-width: 950px;
    margin-top: 40px;
    border-radius: 16px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    padding: 30px;
  }

  h2 {
    text-align: center;
    color: #2b3a67;
    margin-bottom: 20px;
  }

  textarea {
    width: 100%;
    height: 160px;
    padding: 14px 16px;
    font-size: 16px;
    border: 1px solid #d0d7e2;
    border-radius: 10px;
    resize: vertical;
    outline: none;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }

  textarea:focus {
    border-color: #2563eb;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
  }

  .controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin-top: 15px;
  }

  .switch-container {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 30px;
  }

  .switch input {opacity:0;width:0;height:0;}
  .slider {
    position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;
    background-color:#cbd5e1;transition:.4s;border-radius:30px;
  }
  .slider:before {
    position:absolute;content:"";height:22px;width:22px;left:4px;bottom:4px;
    background:white;transition:.4s;border-radius:50%;
  }
  input:checked + .slider {background-color:#2563eb;}
  input:checked + .slider:before {transform:translateX(30px);}
  .mode-label {font-size:15px;font-weight:600;}

  button {
    background:#2563eb;border:none;color:white;padding:10px 20px;
    border-radius:8px;cursor:pointer;font-size:15px;font-weight:500;
    transition:all .3s ease;
  }
  button:hover {background:#1d4ed8;transform:scale(1.02);}
  #clearBtn {background:#ef4444;}
  #clearBtn:hover {background:#dc2626;}

  .filter-sort {
    display:flex;
    flex-wrap:wrap;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    margin-top:20px;
  }

  .filter-sort input, .filter-sort select {
    padding:8px 12px;
    font-size:15px;
    border:1px solid #d0d7e2;
    border-radius:6px;
    outline:none;
  }

  .table-container {
    margin-top:20px;
    overflow-x:auto;
    border-radius:10px;
    border:1px solid #e0e6ef;
  }
  table {border-collapse:collapse;width:100%;}
  th,td {padding:10px 12px;text-align:left;font-size:15px;}
  th {
    background:#eff3fa;color:#444;font-weight:600;text-transform:uppercase;
  }
  tr:nth-child(even){background:#fafbfc;}
  tr:hover{background:#eef3ff;transition:background 0.2s;}

  .summary {
    margin-top:20px;
    background:#f8fafc;
    border-radius:8px;
    padding:14px 18px;
    border:1px solid #e5e7eb;
    font-size:15px;
    line-height:1.8;
    white-space:pre-line;
  }

  .modal {
    display:none;
    position:fixed;
    z-index:1000;
    left:0;top:0;width:100%;height:100%;
    background:rgba(0,0,0,0.6);
    backdrop-filter:blur(4px);
    justify-content:center;
    align-items:center;
    padding:20px;
  }

  .modal-content {
    background:white;
    width:95%;
    max-width:1000px;
    height:80vh;
    border-radius:14px;
    display:flex;
    flex-direction:column;
    animation:fadeIn .3s ease;
  }
  @keyframes fadeIn {from{opacity:0;transform:scale(.95);}to{opacity:1;transform:scale(1);}}
  .modal-header {
    display:flex;justify-content:space-between;align-items:center;
    padding:14px 20px;border-bottom:1px solid #e0e6ef;
  }
  .modal-header h3 {margin:0;color:#2b3a67;}
  .close {font-size:26px;font-weight:bold;cursor:pointer;}
  .modal-body {flex:1;overflow:auto;padding:20px;}
  canvas {width:1200px;height:500px;}
</style>
</head>
<body>
<div class="container">
  <h2>🔢 Number-Aware Text Frequency Analyzer</h2>

  <textarea id="textInput" placeholder="Type or paste text with numbers like -25, 3.14, etc..."></textarea>
<div class="summary" id="summaryBox">
    Total: 0 | Unique: 0 | Characters (with spaces): 0
  </div>
  <div class="controls">
    <div class="switch-container">
      <label class="switch"><input type="checkbox" id="modeToggle"><span class="slider"></span></label>
      <span class="mode-label" id="modeLabel">Word Mode</span>
    </div>
    <button id="openChartBtn">Show Chart</button>
    <button id="clearBtn">Clear</button>
  </div>

  <div class="filter-sort">
    <input type="text" id="filterInput" placeholder="🔍 Filter words, numbers, symbols...">
    <select id="sortSelect">
      <option value="countDesc">Sort by Count ↓</option>
      <option value="countAsc">Sort by Count ↑</option>
      <option value="nameAsc">Sort by Name A–Z</option>
      <option value="nameDesc">Sort by Name Z–A</option>
    </select>
  </div>

  <div class="table-container">
    <table id="freqTable">
      <thead><tr><th id="headerName">Word</th><th>Count</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="summary" id="summaryBox">
    Total: 0 | Unique: 0 | Characters (with spaces): 0
  </div>
</div>

<div id="chartModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Frequency Chart</h3>
      <div>
        <button id="downloadPNG">📥 Download PNG</button>
        <span class="close" id="closeModal">&times;</span>
      </div>
    </div>
    <div class="modal-body"><canvas id="freqChart"></canvas></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const textInput=document.getElementById("textInput");
const freqTableBody=document.querySelector("#freqTable tbody");
const modeToggle=document.getElementById("modeToggle");
const modeLabel=document.getElementById("modeLabel");
const headerName=document.getElementById("headerName");
const openChartBtn=document.getElementById("openChartBtn");
const clearBtn=document.getElementById("clearBtn");
const chartModal=document.getElementById("chartModal");
const closeModal=document.getElementById("closeModal");
const summaryBox=document.getElementById("summaryBox");
const ctx=document.getElementById("freqChart").getContext("2d");
const downloadBtn=document.getElementById("downloadPNG");
const filterInput=document.getElementById("filterInput");
const sortSelect=document.getElementById("sortSelect");

let chart,currentData=[];

function countBreakdown(text){
  const c={letters:0,digits:0,spaces:0,special:0,emojis:0};
  for(const ch of [...text]){
    if(/[a-zA-Z]/.test(ch))c.letters++;
    else if(/[0-9]/.test(ch))c.digits++;
    else if(/\s/.test(ch))c.spaces++;
    else if(/\p{Emoji}/u.test(ch))c.emojis++;
    else c.special++;
  }
  return c;
}

function tokenizeWords(text){
  // Recognizes words, numbers, and signed/decimal numeric tokens
  const regex = /[+-]?\d+(?:\.\d+)?[a-zA-Z%]*|[a-zA-Z]+|[^\s\w]/g;
  return text.match(regex) || [];
}

function getFilteredSortedData(data){
  const filter=filterInput.value.toLowerCase();
  let filtered=data.filter(([item])=>item.toLowerCase().includes(filter));
  const sortType=sortSelect.value;
  filtered.sort((a,b)=>{
    let nameA=a[0].normalize("NFKC"),nameB=b[0].normalize("NFKC");
    let countA=a[1],countB=b[1];
    if(sortType==="countDesc") return countB-countA;
    if(sortType==="countAsc") return countA-countB;
    if(sortType==="nameAsc") return nameA.localeCompare(nameB,undefined,{sensitivity:"base",numeric:true});
    if(sortType==="nameDesc") return nameB.localeCompare(nameA,undefined,{sensitivity:"base",numeric:true});
  });
  return filtered;
}

function updateFrequency(){
  const isCharMode=modeToggle.checked;
  const text=textInput.value;
  localStorage.setItem("savedText",text);
  const freqMap={};
  if(isCharMode){
    for(let ch of text)freqMap[ch]=(freqMap[ch]||0)+1;
  }else{
    const tokens = tokenizeWords(text.toLowerCase());
    tokens.forEach(t=>freqMap[t]=(freqMap[t]||0)+1);
  }
  currentData=Object.entries(freqMap);
  renderTable();
  const total=currentData.reduce((s,[,c])=>s+c,0);
  const unique=currentData.length;
  const breakdown=countBreakdown(text);
  summaryBox.textContent=
    `Total ${isCharMode?"Characters":"Tokens"}: ${total} | Unique: ${unique} | Characters (with spaces): ${text.length}\n`+
    `Letters: ${breakdown.letters} | Digits: ${breakdown.digits} | Spaces: ${breakdown.spaces} | Special: ${breakdown.special} | Emojis: ${breakdown.emojis}`;
}

function renderTable(){
  freqTableBody.innerHTML="";
  const filtered=getFilteredSortedData(currentData);
  for(const [item,count] of filtered){
    const display=item===" "?"(space)":item==="\n"?"(newline)":item==="\t"?"(tab)":item;
    const row=document.createElement("tr");
    row.innerHTML=`<td>${display}</td><td>${count}</td>`;
    freqTableBody.appendChild(row);
  }
}

function openChart(){
  if(!currentData.length)return alert("Please enter text first!");
  chartModal.style.display="flex";
  renderChart(getFilteredSortedData(currentData));
}
function closeChart(){chartModal.style.display="none";}
function renderChart(data){
  const labels=data.map(([i])=>i===" "?"(space)":i==="\n"?"(newline)":i);
  const counts=data.map(([,c])=>c);
  if(chart)chart.destroy();
  chart=new Chart(ctx,{type:"bar",data:{labels,datasets:[{label:"Frequency",data:counts,backgroundColor:"#3b82f6",borderRadius:4}]},options:{responsive:true,maintainAspectRatio:false,scales:{x:{ticks:{autoSkip:false,maxRotation:90,minRotation:45}},y:{beginAtZero:true}},plugins:{legend:{display:false}}}});
}

function clearAll(){
  if(confirm("Clear all text and data?")){
    textInput.value="";localStorage.removeItem("savedText");
    freqTableBody.innerHTML="";
    summaryBox.textContent="Total: 0 | Unique: 0 | Characters (with spaces): 0";
    if(chart)chart.destroy();
  }
}
function downloadChartAsPNG(){
  if(!chart)return alert("No chart to download!");
  const a=document.createElement("a");
  a.download="frequency-chart.png";
  a.href=chart.toBase64Image();
  a.click();
}

window.addEventListener("DOMContentLoaded",()=>{
  const saved=localStorage.getItem("savedText");
  if(saved)textInput.value=saved;
  updateFrequency();
});
textInput.addEventListener("input",updateFrequency);
modeToggle.addEventListener("change",()=>{
  const isChar=modeToggle.checked;
  modeLabel.textContent=isChar?"Character Mode":"Word Mode";
  headerName.textContent=isChar?"Character":"Token";
  updateFrequency();
});
filterInput.addEventListener("input",renderTable);
sortSelect.addEventListener("change",renderTable);
openChartBtn.addEventListener("click",openChart);
closeModal.addEventListener("click",closeChart);
clearBtn.addEventListener("click",clearAll);
downloadBtn.addEventListener("click",downloadChartAsPNG);
window.addEventListener("click",e=>{if(e.target===chartModal)closeChart();});
</script>
</body>
</html>
